"""Generate entrezID to symbol map using BioPython.
Use IDs gleened from previous run of tfgene2targetgene.py.

USE:
python test_biopython.py > static_entrez_py_dict.txt
"""
import Bio
IDS = [100049542,100130691,100132476,100287792,100287896,100289580,10225,10278,10298,10600,10681,10715,10733,10800,10804,10868,10948,11014,11015,11030,11157,11237,11274,1135,114785,116173,116519,1182,1183,1187,122416,1240,124540,124923,1268,134957,140258,140456,140461,140606,140691,142686,144165,1446,1482,148231,148252,148872,149134,150596,151009,154089,1588,1591,1592,161003,162466,167359,167465,171017,1748,1816,1909,200058,200317,2051,2059,206338,2100,2109,2146,222161,222484,222545,22809,22925,22999,2316,2323,23295,23327,23574,23646,23658,2492,252842,2550,255180,2561,2566,26716,27040,2706,27065,27334,2798,2825,283174,2833,2835,283518,2840,2841,2845,2847,285150,285492,285759,285962,286023,2885,2890,2893,2903,29091,2913,2918,29993,30819,30820,3164,3276,3305,337879,337880,338799,3568,3643,3655,3683,3691,374467,375298,3779,387569,388152,388685,389199,3895,389792,3920,392490,399819,399827,399886,399975,399990,400207,400454,400511,400535,400576,400624,400658,400661,400666,400841,400863,400867,400870,400926,400930,401105,401123,401157,401281,401472,4025,403312,403340,405,4074,4158,4205,4221,4233,4281,4306,4313,439914,439933,4481,4799,4926,4929,5031,51070,51207,51222,51306,51330,5136,5153,5154,51582,51617,5168,51704,51714,51765,51776,53831,53836,54205,54329,54584,54799,54886,55147,55172,55190,55212,55294,55342,554,5540,5570,55713,55715,55719,55743,55777,55890,56062,56159,57211,5731,5739,5754,57541,57664,57720,5774,5782,5786,5787,58515,5914,5919,59285,59347,60592,6097,623,624,6324,6337,6404,64067,644903,64748,64805,64806,64841,65109,652276,6559,6622,6667,6711,6751,6752,6753,6755,6843,6844,6856,6895,6943,7015,7056,7106,7113,7248,728175,729,7421,7745,7763,7771,7852,7908,79667,79760,80094,8013,80344,8078,80821,80835,8087,81491,81691,8193,83642,83873,83899,83902,83930,83999,84181,84616,84684,8477,84796,84931,85280,85289,85291,8600,8651,8740,8743,8890,9021,90768,91179,9138,92359,9278,9289,9364,9403,943,9454,9455,951,9655,96610,967,973,974,9806,9900,9970,9992]

from biopython_entrez import *
import hugo_gene_symbols

if __name__ == "__main__":
  H = hugo_gene_symbols.load()
  d = generate_dict(retrieve_annotation(map(str,IDS)))
  checked, remapped, multi, missed = 0,0,0,0
  # attempt to remap symbols using hugo
  for eid in d:
    sym = d[eid]
    if not sym: continue
    # manual remap
    if sym == "PRG1":
      d[eid] = "SRGN"
      continue
    checked += 1
    official_sym = H.find_sym(sym, allow_dupe=True)
    if not official_sym:
      missed += 1 # keep symbol, even though it is not official
    elif isinstance(official_sym,set):
      multi += 1
      print >>sys.stderr, "MULTI:", eid, sym, official_sym
    elif official_sym != sym:
      d[eid] = official_sym
      remapped += 1
  print >>sys.stderr, "checked", checked, "remapped",remapped, "multi",multi, "missed", missed
  print d
